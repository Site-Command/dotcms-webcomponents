import{r as t,c as i,h as e,g as n,H as o}from"./p-ca5d1561.js";import{c as s,a as r}from"./p-2094943b.js";var a=s((function(t){t.exports=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=function(t){return t.innerHTML=""},e=function(t,e,n,o,s,r){o({event:t,query:e instanceof HTMLInputElement?e.value:e.innerHTML,matches:s.matches,results:s.list.map((function(t){return t.value})),selection:s.list.find((function(i){return 13===t.keyCode?i.index===Number(r.getAttribute("data-id")):"mousedown"===t.type?i.index===Number(t.currentTarget.getAttribute("data-id")):void 0}))}),i(n)},n=function(t){return"string"==typeof t?document.querySelector(t):t()},o=function(t){return"<span class=".concat("autoComplete_highlighted",">").concat(t,"</span>")},s=i,r=function(t,i){i=i||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,i.bubbles,i.cancelable,i.detail),e};r.prototype=window.Event.prototype;var a={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||r,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var i=this;do{if(i.matches(t))return i;i=i.parentElement||i.parentNode}while(null!==i&&1===i.nodeType);return null})}};return function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);var e,o,s=t.selector,r=void 0===s?"#autoComplete":s,a=t.data,l=a.key,u=a.src,c=a.cache,h=void 0===c||c,d=t.query,f=t.trigger,v=(f=void 0===f?{}:f).event,m=void 0===v?["input"]:v,p=f.condition,b=void 0!==p&&p,g=t.searchEngine,w=void 0===g?"strict":g,y=t.threshold,x=void 0===y?0:y,E=t.debounce,C=void 0===E?0:E,k=t.resultsList,T=(k=void 0===k?{}:k).render,_=void 0!==T&&T,L=k.container,D=k.position,R=void 0===D?"afterend":D,I=k.element,M=void 0===I?"ul":I,H=k.navigation,z=void 0!==H&&H,P=t.sort,j=void 0!==P&&P,O=t.placeHolder,q=t.maxResults,A=void 0===q?5:q,B=t.resultItem,K=(B=void 0===B?{}:B).content,N=void 0!==K&&K,S=B.element,$=void 0===S?"li":S,F=t.noResults,W=t.highlight,G=void 0!==W&&W,J=t.onSelection,Q=_?(e={container:void 0!==L&&L,destination:k.destination||n(r),position:R,element:M},(o=document.createElement(e.element)).setAttribute("id","autoComplete_list"),e.container&&e.container(o),e.destination.insertAdjacentElement(e.position,o),o):null;this.selector=r,this.data={src:function(){return"function"==typeof u?u():u},key:l,cache:h},this.query=d,this.trigger={event:m,condition:b},this.searchEngine="loose"===w?"loose":"function"==typeof w?w:"strict",this.threshold=x,this.debounce=C,this.resultsList={render:_,view:Q,navigation:z},this.sort=j,this.placeHolder=O,this.maxResults=A,this.resultItem={content:N,element:$},this.noResults=F,this.highlight=G,this.onSelection=J,this.init()}var r,l;return r=i,(l=[{key:"search",value:function(t,i){var e=i.toLowerCase();if("loose"===this.searchEngine){t=t.replace(/ /g,"");for(var n=[],s=0,r=0;r<e.length;r++){var a=i[r];s<t.length&&e[r]===t[s]&&(a=this.highlight?o(a):a,s++),n.push(a)}return s===t.length&&n.join("")}if(e.includes(t))return t=new RegExp("".concat(t),"i").exec(i),this.highlight?i.replace(t,o(t)):i}},{key:"listMatchedResults",value:function(t){var i=this;return new Promise((function(e){var n=[];t.filter((function(t,e){var o=function(o){var s=o?t[o]:t;if(s){var r="function"==typeof i.searchEngine?i.searchEngine(i.queryValue,s):i.search(i.queryValue,s);r&&o?n.push({key:o,index:e,match:r,value:t}):r&&!o&&n.push({index:e,match:r,value:t})}};if(i.data.key){var s=!0,r=!1,a=void 0;try{for(var l,u=i.data.key[Symbol.iterator]();!(s=(l=u.next()).done);s=!0)o(l.value)}catch(c){r=!0,a=c}finally{try{s||null==u.return||u.return()}finally{if(r)throw a}}}else o()}));var o=i.sort?n.sort(i.sort).slice(0,i.maxResults):n.slice(0,i.maxResults);return e({matches:n.length,list:o})}))}},{key:"ignite",value:function(){var t=this,i=n(this.selector);this.placeHolder&&i.setAttribute("placeholder",this.placeHolder);var o=function(n){Promise.resolve(t.data.cache?t.dataStream:t.data.src()).then((function(o){t.dataStream=o,function(n){var o=i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement?i.value.toLowerCase():i.innerHTML.toLowerCase(),r=t.queryValue=t.query&&t.query.manipulate?t.query.manipulate(o):o,l=t.resultsList.render,u=t.trigger.condition?t.trigger.condition(r):r.length>t.threshold&&r.replace(/ /g,"").length,c=function(t,e){i.dispatchEvent(new a.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:t,input:o,query:r,matches:e?e.matches:null,results:e?e.list:null},cancelable:!0}))};if(l){var h=t.resultsList.view;s(h),u?t.listMatchedResults(t.dataStream,n).then((function(o){c(n,o),t.resultsList.render&&(0===o.list.length&&t.noResults?t.noResults():(function(t,i,e){var n=document.createDocumentFragment();i.forEach((function(t,o){var s=document.createElement(e.element);s.setAttribute("data-id",i[o].index),s.setAttribute("class","autoComplete_result"),e.content?e.content(t,s):s.innerHTML=t.match||t,n.appendChild(s)})),t.appendChild(n)}(h,o.list,t.resultItem),t.onSelection&&(t.resultsList.navigation?t.resultsList.navigation(n,i,h,t.onSelection,o):function(t,i,n,o){var s,r=i.childNodes,a=r.length-1,l=void 0,u=function(t){l.classList.remove("autoComplete_selected"),s=1===t?l.nextSibling:l.previousSibling},c=function(t){(l=t).classList.add("autoComplete_selected")};t.onkeydown=function(h){if(r.length>0)switch(h.keyCode){case 38:l?(u(0),c(s||r[a])):c(r[a]);break;case 40:l?(u(1),c(s||r[0])):c(r[0]);break;case 13:l&&e(h,t,i,n,o,l)}},r.forEach((function(s){s.onmousedown=function(s){return e(s,t,i,n,o)}}))}(i,h,t.onSelection,o))))})):c(n)}else!l&&u&&t.listMatchedResults(t.dataStream,n).then((function(t){c(n,t)}))}(n)}))};this.trigger.event.forEach((function(e){var n,s,r;i.addEventListener(e,(n=function(t){return o(t)},s=t.debounce,function(){var t=this,i=arguments;clearTimeout(r),r=setTimeout((function(){return n.apply(t,i)}),s)}))}))}},{key:"init",value:function(){var t=this;this.data.cache?Promise.resolve(this.data.src()).then((function(i){t.dataStream=i,t.ignite()})):this.ignite(),a.initElementClosestPolyfill()}}])&&t(r.prototype,l),i}()}()}));const l=class{constructor(e){t(this,e),this.selection=i(this,"selection",7),this.enter=i(this,"enter",7),this.lostFocus=i(this,"lostFocus",7),this.disabled=!1,this.placeholder="",this.threshold=0,this.maxResults=0,this.debounce=300,this.data=null,this.id="autoComplete"+(new Date).getTime(),this.keyEvent={Enter:this.emitEnter.bind(this),Escape:this.clean.bind(this)}}componentDidLoad(){this.data&&this.initAutocomplete()}render(){return e("input",{autoComplete:"off",disabled:this.disabled||null,id:this.id,onBlur:t=>this.handleBlur(t),onKeyDown:t=>this.handleKeyDown(t),placeholder:this.placeholder||null})}watchThreshold(){this.initAutocomplete()}watchData(){this.initAutocomplete()}watchMaxResults(){this.initAutocomplete()}handleKeyDown(t){const{value:i}=this.getInputElement();i&&this.keyEvent[t.key]&&(t.preventDefault(),this.keyEvent[t.key](i))}handleBlur(t){t.preventDefault(),setTimeout(()=>{document.activeElement.parentElement!==this.getResultList()&&(this.clean(),this.lostFocus.emit(t))},0)}clean(){this.getInputElement().value="",this.cleanOptions()}cleanOptions(){this.getResultList().innerHTML=""}emitselect(t){this.clean(),this.selection.emit(t)}emitEnter(t){t&&(this.clean(),this.enter.emit(t))}getInputElement(){return this.el.querySelector("#"+this.id)}initAutocomplete(){this.clearList(),new a({data:{src:async()=>this.getData()},sort:(t,i)=>t.match<i.match?-1:t.match>i.match?1:0,placeHolder:this.placeholder,selector:"#"+this.id,threshold:this.threshold,searchEngine:"strict",highlight:!0,maxResults:this.maxResults,debounce:this.debounce,resultsList:{container:()=>this.getResultListId(),destination:this.getInputElement(),position:"afterend"},resultItem:({match:t})=>t,onSelection:({event:t,selection:i})=>{t.preventDefault(),this.focusOnInput(),this.emitselect(i.value)}})}clearList(){const t=this.getResultList();t&&t.remove()}focusOnInput(){this.getInputElement().focus()}getResultList(){return this.el.querySelector("#"+this.getResultListId())}getResultListId(){return this.id+"_results_list"}async getData(){const t=this.getInputElement();t.setAttribute("placeholder","Loading...");const i="function"==typeof this.data?await this.data():[];return t.setAttribute("placeholder",this.placeholder||""),i}get el(){return n(this)}static get watchers(){return{threshold:["watchThreshold"],data:["watchData"],maxResults:["watchMaxResults"]}}};l.style="dot-autocomplete input{-webkit-box-sizing:border-box;box-sizing:border-box;width:200px}dot-autocomplete ul{background-color:#fff;list-style:none;margin:0;max-height:300px;overflow:auto;padding:0;position:absolute;width:200px}dot-autocomplete ul li{background-color:#fff;border-top:0;border:solid 1px #ccc;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer;padding:0.25rem}dot-autocomplete ul li:first-child{border-top:solid 1px #ccc}dot-autocomplete ul li:focus{background-color:lightyellow;outline:0}dot-autocomplete ul li .autoComplete_highlighted{font-weight:bold}";const u=class{constructor(e){t(this,e),this.remove=i(this,"remove",7),this.label="",this.deleteLabel="Delete",this.disabled=!1}render(){const t=this.label?`${this.deleteLabel} ${this.label}`:null;return e(o,null,e("span",null,this.label),e("button",{type:"button","aria-label":t,disabled:this.disabled,onClick:()=>this.remove.emit(this.label)},this.deleteLabel))}get el(){return n(this)}};u.style="dot-chip span{margin-right:0.25rem}dot-chip button{cursor:pointer}";export{l as dot_autocomplete,u as dot_chip}